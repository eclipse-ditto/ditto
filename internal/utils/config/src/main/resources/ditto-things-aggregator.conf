ditto.things-aggregator {
  max-parallelism = 20
  max-parallelism = ${?THINGS_AGGREGATOR_MAX_PARALLELISM}
}

# ask-with-retry is used in ThingsAggregatorActor to more reliably retrieve things from ThingShardRegions
ditto.ask-with-retry {
  # maximum duration to wait for answers from thing shard region
  ask-timeout = 10s
  ask-timeout = ${?THINGS_ASK_WITH_RETRY_ASK_TIMEOUT}

  # one of: OFF, NO_DELAY, FIXED_DELAY, BACKOFF_DELAY
  retry-strategy = BACKOFF_DELAY
  retry-strategy = ${?THINGS_ASK_WITH_RETRY_ASK_RETRY_STRATEGY}

  retry-attempts = 3
  retry-attempts = ${?THINGS_ASK_WITH_RETRY_ASK_TIMEOUT_RETRIES}

  fixed-delay = 5s
  fixed-delay = ${?THINGS_ASK_WITH_RETRY_ASK_FIXED_DELAY}

  backoff-delay {
    min = 100ms
    min = ${?THINGS_ASK_WITH_RETRY_ASK_BACKOFF_DELAY_MIN}
    max = 10s
    max = ${?THINGS_ASK_WITH_RETRY_ASK_BACKOFF_DELAY_MAX}
    # must be between 0.0 and 1.0:
    random-factor = 0.5
    random-factor = ${?THINGS_ASK_WITH_RETRY_ASK_BACKOFF_DELAY_RANDOM_FACTOR}
  }
}

aggregator-internal-dispatcher {
  # Dispatcher is the name of the event-based dispatcher
  type = Dispatcher
  # What kind of ExecutionService to use
  executor = "org.eclipse.ditto.internal.utils.metrics.service.executor.InstrumentedForkJoinExecutorServiceConfigurator"
  # Configuration for the fork join pool
  fork-join-executor {
    # Min number of threads to cap factor-based parallelism number to
    parallelism-min = 4
    # Parallelism (threads) ... ceil(available processors * factor)
    parallelism-factor = 3.0
    # Max number of threads to cap factor-based parallelism number to
    parallelism-max = 32
    parallelism-max = ${?DEFAULT_DISPATCHER_PARALLELISM_MAX}
  }
  # Throughput defines the maximum number of messages to be
  # processed per actor before the thread jumps to the next actor.
  # Set to 1 for as fair as possible.
  throughput = 5
}
